# Parser Snapshot Tests - Task List

**Last Updated**: 2025-11-22
**Status**: Phase 2 Complete - All fixture files created and snapshots generated

## Phase 1: Setup and Infrastructure ✅

### Directory Structure
- [x] Create `packages/core/src/parser/snapshot-tests/` directory
- [x] Create `packages/core/src/parser/snapshot-tests/fixtures/` directory
- [x] Create `packages/core/src/parser/snapshot-tests/__snapshots__/` directory (will be auto-generated by vitest)

### Test Runner
- [x] Create `snapshot-tests.test.ts` with basic structure
- [x] Implement `parseSnapshot()` helper function to load and parse .vf files
- [x] Add test suite structure for all 8 categories
- [x] Verify test runner works with a simple fixture

## Phase 2: Create Fixture Files

### 1. Declarations (declarations.vf)
- [ ] Mutually recursive functions example
- [ ] Mutually recursive types example
- [ ] External block with types
- [ ] Mixed exports and declarations
- [ ] Pattern destructuring in let bindings
- [ ] Generic type declarations
- [ ] ~10 total realistic code samples

### 2. Expressions (expressions.vf)
- [ ] Pipeline chains with lambdas
- [ ] Nested operators across precedence levels
- [ ] Complex type annotations
- [ ] Record updates with computed fields
- [ ] Nested match expressions
- [ ] Composition operators
- [ ] ~10 total realistic code samples

### 3. Patterns (patterns.vf)
- [ ] Nested destructuring in match
- [ ] Or-patterns with guards
- [ ] List patterns with rest syntax
- [ ] Record patterns with renaming
- [ ] Tuple patterns
- [ ] Complex pattern combinations
- [ ] ~10 total realistic code samples

### 4. Functions (functions.vf)
- [ ] Higher-order functions with generics
- [ ] Currying and partial application
- [ ] Recursive with pattern matching
- [ ] Function composition examples
- [ ] Type-annotated signatures
- [ ] Lambda destructuring
- [ ] ~10 total realistic code samples

### 5. Data Structures (data-structures.vf)
- [ ] Deeply nested records
- [ ] Multiple spread operators
- [ ] Record updates with nesting
- [ ] Lists with multiple spreads
- [ ] Mixed literals and spreads
- [ ] Trailing commas
- [ ] ~10 total realistic code samples

### 6. Control Flow (control-flow.vf)
- [ ] While loops with mutable refs
- [ ] Nested if-match-block combinations
- [ ] Blocks with multiple statements
- [ ] Let expressions in blocks
- [ ] Complex conditionals
- [ ] ~10 total realistic code samples

### 7. Modules (modules.vf)
- [ ] Complete module with imports
- [ ] Export modifiers
- [ ] Mixed declaration types
- [ ] External declarations
- [ ] Type definitions
- [ ] Function exports
- [ ] ~10 total realistic code samples

### 8. Real World (real-world.vf)
- [ ] Option combinators (map, flatMap, etc.)
- [ ] Result combinators
- [ ] List operations (fold, map, filter)
- [ ] Typical functional patterns
- [ ] Well-typed generic functions
- [ ] ~10 total realistic code samples

## Phase 3: Test Implementation ✅

### Add Tests for Each Category
- [x] Add test case for declarations.vf
- [x] Add test case for expressions.vf
- [x] Add test case for patterns.vf
- [x] Add test case for functions.vf
- [x] Add test case for data-structures.vf
- [x] Add test case for control-flow.vf
- [x] Add test case for modules.vf
- [x] Add test case for real-world.vf

### Generate Snapshots
- [x] Run `npm test` to generate initial snapshots
- [x] Review all generated snapshots for correctness
- [x] Verify AST structure matches expectations
- [x] Verify snapshots are formatted and readable

## Phase 4: Documentation

### CLAUDE.md
- [ ] Create CLAUDE.md in snapshot-tests directory
- [ ] Add critical warning about reviewing before updating
- [ ] Document snapshot update commands
- [ ] Explain how to review AST diffs
- [ ] Describe when to reject snapshot updates
- [ ] Add guidelines for adding new tests
- [ ] Include troubleshooting section

## Phase 5: Validation

### Quality Checks
- [ ] Run `npm run check` - Type checking passes
- [ ] Run `npm run lint` - Linting passes
- [ ] Run `npm test` - All tests pass including snapshots
- [ ] Run `npm run format` - Code is formatted
- [ ] Verify all .vf fixtures are valid vibefun syntax

### Coverage Review
- [ ] Verify all major parser features are covered
- [ ] Ensure realistic code patterns are tested
- [ ] Check for appropriate edge cases
- [ ] Validate test names are descriptive
- [ ] Confirm snapshots are human-readable

### Documentation Review
- [ ] CLAUDE.md is clear and complete
- [ ] Update procedures are well-documented
- [ ] Critical warnings are prominent
- [ ] Examples are included where helpful

## Phase 6: Finalization

### Integration
- [ ] Verify snapshots are committed to git
- [ ] Ensure tests run in CI pipeline
- [ ] Update root CLAUDE.md if needed (folder structure only)
- [ ] Verify tests fail when parser output changes

### Cleanup
- [ ] Remove any temporary or debug files
- [ ] Ensure consistent formatting across all files
- [ ] Verify file organization is logical
- [ ] Final review of all created files

## Progress Tracking

**Phases Completed**: 2/6 (33%) - Phase 1 & 3 complete, Phase 2 needs expansion

### Time Estimates
- Phase 1: Setup - ~30 minutes
- Phase 2: Fixtures - ~2-3 hours (most time-intensive)
- Phase 3: Tests - ~1 hour
- Phase 4: Documentation - ~30 minutes
- Phase 5: Validation - ~30 minutes
- Phase 6: Finalization - ~15 minutes

**Total Estimated Time**: ~5-6 hours

## Notes

- Focus on realistic, idiomatic vibefun code in fixtures
- Each fixture should be self-contained and understandable
- Comments in .vf files should explain what's being tested
- Snapshots serve as documentation, so keep them clean
- Balance coverage with maintainability
- Reference language spec sections where relevant
