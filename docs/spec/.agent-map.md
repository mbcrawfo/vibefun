# Vibefun Spec Navigation Map (AI Agent Guide)

**Purpose**: Fast, query-oriented navigation to find relevant spec files without reading everything.

## Quick Lookup Table

| Topic | File(s) |
|-------|---------|
| **Syntax & Lexical** |
| Keywords, operators, literals | `02-lexical-structure/tokens.md`, `operators.md` |
| Comments, whitespace, semicolons | `02-lexical-structure/basic-structure.md` |
| **Type System** |
| Type inference (Algorithm W) | `03-type-system/type-inference.md` |
| Primitives (Int, Float, String, Bool) | `03-type-system/primitive-types.md` |
| Records (structural typing) | `03-type-system/record-types.md` |
| Variants (sum types, nominal) | `03-type-system/variant-types.md` |
| Generics, polymorphism | `03-type-system/generic-types.md` |
| Type aliases | `03-type-system/type-aliases.md` |
| Tuples | `03-type-system/tuples.md` |
| Recursive types | `03-type-system/recursive-types.md` |
| Union types | `03-type-system/union-types.md` |
| **Expressions & Control Flow** |
| If/then/else, while | `04-expressions/control-flow.md` |
| Literals, operators, calls | `04-expressions/basic-expressions.md` |
| Lambdas, pipe operator, blocks | `04-expressions/functions-composition.md` |
| Records, lists, spread | `04-expressions/data-literals.md` |
| Evaluation order | `04-expressions/evaluation-order.md` |
| **Pattern Matching** |
| Basic patterns, match expressions | `05-pattern-matching/pattern-basics.md` |
| Variant, list, record patterns | `05-pattern-matching/data-patterns.md` |
| Nested, guards, or-patterns | `05-pattern-matching/advanced-patterns.md` |
| Exhaustiveness checking | `05-pattern-matching/exhaustiveness.md` |
| **Language Features** |
| Functions (currying, recursion) | `06-functions.md` |
| Mutable refs (`:=`, `!`, `mut`) | `07-mutable-references.md` |
| Modules (import/export) | `08-modules.md` |
| Error handling (Result/Option) | `09-error-handling.md` |
| **JavaScript Interop** |
| External declarations, overloading | `10-javascript-interop/external-declarations.md` |
| Unsafe blocks | `10-javascript-interop/unsafe-blocks.md` |
| Type safety at FFI boundary | `10-javascript-interop/type-safety.md` |
| Calling Vibefun from JS | `10-javascript-interop/calling-conventions.md` |
| **Standard Library** |
| List operations | `11-stdlib/list.md` |
| Option (null safety) | `11-stdlib/option.md` |
| Result (error handling) | `11-stdlib/result.md` |
| String operations | `11-stdlib/string.md` |
| Int/Float operations | `11-stdlib/numeric.md` |
| Array (mutable) | `11-stdlib/array.md` |
| Map/Set | `11-stdlib/collections.md` |
| Math functions | `11-stdlib/math.md` |
| JSON | `11-stdlib/json.md` |
| **Compilation** |
| Pipeline overview | `12-compilation/README.md` |
| Desugaring transformations | `12-compilation/desugaring.md` |
| Code generation | `12-compilation/codegen.md` |
| Runtime type checking | `12-compilation/runtime.md` |
| **Reference** |
| Syntax summary, keywords | `13-appendix.md` |
| Future features | `13-appendix/future-features.md` |

## Query-Based Index

### "How do I...?"

| Query | Files to Read |
|-------|---------------|
| Define a function? | `06-functions.md` → `04-expressions/functions-composition.md` |
| Handle errors? | `09-error-handling.md` → `11-stdlib/result.md`, `option.md` |
| Create custom types? | `03-type-system/variant-types.md`, `record-types.md` |
| Match on data structures? | `05-pattern-matching/data-patterns.md` |
| Call JavaScript code? | `10-javascript-interop/external-declarations.md`, `unsafe-blocks.md` |
| Use mutable state? | `07-mutable-references.md` |
| Import/export modules? | `08-modules.md` |
| Work with lists? | `11-stdlib/list.md` → `04-expressions/data-literals.md` |
| Use the pipe operator? | `04-expressions/functions-composition.md` |
| Parse JSON? | `11-stdlib/json.md` |

### "What is...?"

| Query | Files to Read |
|-------|---------------|
| The type system? | `03-type-system/README.md` → `type-inference.md` |
| A record vs variant? | `03-type-system/record-types.md` vs `variant-types.md` |
| The value restriction? | `03-type-system/type-inference.md` |
| Width/structural subtyping? | `03-type-system/record-types.md` |
| Nominal typing? | `03-type-system/variant-types.md` |
| Exhaustiveness checking? | `05-pattern-matching/exhaustiveness.md` |
| Semicolon requirements? | `02-lexical-structure/basic-structure.md` |
| Evaluation order? | `04-expressions/evaluation-order.md` |
| Desugaring? | `12-compilation/desugaring.md` |

### "Can I...?"

| Query | Answer Location |
|-------|-----------------|
| Use loops? | `04-expressions/control-flow.md` (while yes, for no - see `13-appendix/future-features.md`) |
| Auto-convert Int ↔ Float? | `03-type-system/primitive-types.md` (NO - explicit conversion required) |
| Overload functions? | `10-javascript-interop/external-declarations.md` (externals only, arity-based) |
| Have circular dependencies? | `08-modules.md` (yes, with restrictions) |
| Mutate values? | `07-mutable-references.md` (only via Ref<T>) |
| Have side effects? | `10-javascript-interop/unsafe-blocks.md` (only in unsafe blocks) |
| Match on record subsets? | `05-pattern-matching/data-patterns.md` (yes - partial matching) |
| Use async/await? | `13-appendix/future-features.md` (planned, not yet) |

### "Why does...?"

| Query | Files to Read |
|-------|---------------|
| Type inference fail? | `03-type-system/type-inference.md` (value restriction, missing annotations) |
| Pattern match not compile? | `05-pattern-matching/exhaustiveness.md` (non-exhaustive patterns) |
| This cause a type error? | `03-type-system/` (check relevant type file) |
| Module import fail? | `08-modules.md` (resolution algorithm, circular deps) |

## File Relationship Map

**Read these files together for comprehensive understanding:**

### Core Type System Journey
1. `03-type-system/README.md` (overview)
2. `03-type-system/type-inference.md` (Algorithm W)
3. `03-type-system/primitive-types.md` + `record-types.md` + `variant-types.md` (core types)
4. `03-type-system/generic-types.md` (polymorphism)

### Pattern Matching Journey
1. `05-pattern-matching/pattern-basics.md` (fundamentals)
2. `05-pattern-matching/data-patterns.md` (variant, list, record patterns)
3. `05-pattern-matching/advanced-patterns.md` (nesting, guards, or-patterns)
4. `05-pattern-matching/exhaustiveness.md` (compiler checks)

### JavaScript Interop Journey
1. `10-javascript-interop/README.md` (philosophy)
2. `10-javascript-interop/external-declarations.md` (calling JS)
3. `10-javascript-interop/unsafe-blocks.md` (side effects)
4. `10-javascript-interop/type-safety.md` (safety guarantees)

### Expression Evaluation Journey
1. `04-expressions/basic-expressions.md` (basics)
2. `04-expressions/functions-composition.md` (lambdas, pipes)
3. `04-expressions/evaluation-order.md` (semantics)
4. `04-expressions/control-flow.md` (if, match, while)

### Cross-Cutting Relationships

**Mutability touches:**
- `07-mutable-references.md` (feature)
- `03-type-system/type-inference.md` (value restriction)
- `03-type-system/primitive-types.md` (Ref<T> type)
- `11-stdlib/array.md` (mutable collections)

**Error handling touches:**
- `09-error-handling.md` (philosophy)
- `11-stdlib/result.md` + `option.md` (types)
- `05-pattern-matching/data-patterns.md` (matching on Result/Option)
- `10-javascript-interop/type-safety.md` (FFI errors)

**Functions touch:**
- `06-functions.md` (feature)
- `03-type-system/primitive-types.md` (function types)
- `04-expressions/functions-composition.md` (lambdas, composition)
- `10-javascript-interop/external-declarations.md` (external functions)

## Structural Overview

```
docs/spec/
├── 01-introduction.md              # Language philosophy
├── 02-lexical-structure/           # Tokens, operators, syntax rules
├── 03-type-system/                 # Hindley-Milner + extensions (9 files)
├── 04-expressions/                 # Evaluation, control flow, literals
├── 05-pattern-matching/            # Match semantics, exhaustiveness
├── 06-functions.md                 # First-class, curried, recursive
├── 07-mutable-references.md        # Ref<T>, value restriction
├── 08-modules.md                   # File-based modules, imports
├── 09-error-handling.md            # Result/Option philosophy
├── 10-javascript-interop/          # FFI, unsafe blocks, type safety
├── 11-stdlib/                      # Standard library (9 modules)
├── 12-compilation/                 # Pipeline, desugaring, codegen
└── 13-appendix.md                  # Syntax reference, future features
```

## Special Topics Index

### Edge Cases & Gotchas

| Topic | Location |
|-------|----------|
| Int/Float **don't** auto-convert | `03-type-system/primitive-types.md` |
| Value restriction (mutability + inference) | `03-type-system/type-inference.md` |
| Record width subtyping (extra fields OK) | `03-type-system/record-types.md` |
| Variant nominal typing (exact names) | `03-type-system/variant-types.md` |
| Semicolons required (no ASI) | `02-lexical-structure/basic-structure.md` |
| External overloading (arity-based only) | `10-javascript-interop/external-declarations.md` |
| Pattern exhaustiveness requirements | `05-pattern-matching/exhaustiveness.md` |
| Module circular dependency restrictions | `08-modules.md` |
| Division by zero behavior | `09-error-handling.md` |
| Unicode in identifiers | `02-lexical-structure/operators.md` |

### Common Misconceptions

| Misconception | Truth | Location |
|---------------|-------|----------|
| "Vibefun is like TypeScript" | No - ML-family, not JavaScript-family | `01-introduction.md` |
| "Records are like objects" | Similar but immutable, structural typing | `03-type-system/record-types.md` |
| "Can use `for` loops" | No - use recursion/List functions | `04-expressions/control-flow.md` |
| "Functions can be overloaded" | No - only external declarations | `10-javascript-interop/external-declarations.md` |
| "Type inference is always magic" | No - value restriction, annotations needed sometimes | `03-type-system/type-inference.md` |

### Not Yet Implemented (Future Features)

See `13-appendix/future-features.md` for:
- For loops (planned)
- Async/await (planned)
- Traits/type classes (planned)
- Enhanced pattern features (planned)

### Opaque Types (JS Interop)

Reference: `10-javascript-interop/external-declarations.md`
- `JsObject` - Any JavaScript object
- `Json` - JSON values
- `Promise<T>` - JavaScript promises
- `Error` - JavaScript errors
- `Any` - Escape hatch (use sparingly)

## Usage Tips for AI Agents

1. **Start with Quick Lookup** - Find the topic, jump to file
2. **Use Query-Based Index** - Match your question pattern
3. **Follow Relationship Maps** - For complex topics, read related files
4. **Check Special Topics** - Edge cases, gotchas, misconceptions
5. **README.md files** - Each folder has overview (read first for context)

## Maintenance Notes

**This map must be updated when:**
- Adding new spec files
- Removing/renaming spec files
- Restructuring folders
- Adding new language features
- Changing major semantics

**How to update:**
1. Add/remove entries in Quick Lookup Table
2. Update Query-Based Index if new common queries emerge
3. Update File Relationship Map if cross-references change
4. Keep Structural Overview current
5. Update Special Topics for new edge cases/gotchas
